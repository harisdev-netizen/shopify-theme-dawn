<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css">

{%- liquid
  assign banner_title = section.settings.title
  assign banner_description = section.settings.description
  assign button_link = section.settings.button_link
  assign button_text = section.settings.button_text
  assign swiper_aspect_desktop = section.settings.swiper_aspect_desktop
  assign swiper_aspect_mobile = section.settings.swiper_aspect_mobile
  assign unique_id = section.id
  assign autoplay_speed = section.settings.autoplay_speed
  assign bullet_color = section.settings.bullet_color
  assign active_bullet_color = section.settings.active_bullet_color
  assign pagination_margin_top = section.settings.pagination_margin_top
  assign pagination_margin_top_mobile = section.settings.pagination_margin_top_mobile
  assign pagination_min_height = section.settings.pagination_min_height
  assign pagination_min_height_mobile = section.settings.pagination_min_height_mobile
  assign bullet_width = section.settings.bullet_width
  assign bullet_height = section.settings.bullet_height
  assign bullet_radius = section.settings.bullet_radius
  assign bullet_width_mobile = section.settings.bullet_width_mobile
  assign bullet_height_mobile = section.settings.bullet_height_mobile
  assign bullet_active_width_mobile = section.settings.bullet_active_width_mobile
  assign bullet_active_width = section.settings.bullet_active_width
-%}

{% stylesheet %}
  .banner-wrapper {
    overflow-x: hidden;
  }

  .autoplay-slideshow {
    width: 100%;
    position: relative;
    overflow: visible !important;
  }

  .autoplay-slideshow .swiper-wrapper {
    width: 100%;
    height: auto;
    aspect-ratio: var(--swiper-aspect-desktop);
    position: relative;
  }

  @media screen and (max-width: 749px) {
    .autoplay-slideshow .swiper-wrapper {
      aspect-ratio: var(--swiper-aspect-mobile);
    }
  }

  .swiper-slide {
    width: 100%;
    height: 100%;
    top: 0;
    left: 0;
  }

  .swiper-slide img {
    display: block;
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .banner-content {
    position: relative;
    /* display: flex; */
    /* align-items: center; */
    /* justify-content: flex-start; */
    height: 100%;
    /* padding: 2rem; */
    color: var(--banner-title-color);
  }

  .banner-text {
    position: absolute;
    left: 100px;
    top: 50%;
    transform: translateY(-50%);
    z-index: 2;
    display: flex;
    align-items: flex-start;
    justify-content: center;
    flex-direction: column;
    max-width: 800px;
    width: 100%;
    margin: 0 auto 0 5%;
    text-align: start;
  }

  .banner-title {
    font-size: var(--banner-title-font-size);
    font-family: var(--banner-title-font-family);
    font-weight: var(--banner-title-font-weight);
    margin-bottom: 1rem;
    color: var(--banner-title-color);
  }

  .banner-description {
    font-size: var(--banner-description-font-size);
    font-family: var(--banner-description-font-family);
    font-weight: var(--banner-description-font-weight);
    margin-bottom: 1.5rem;
    color: var(--banner-title-color);
    max-width: 90%;
    line-height: 1.4;
  }

  .banner-button {
    display: inline-block;
    padding: 0.75rem 1.5rem;
    background-color: var(--banner-button-color);
    color: var(--banner-button-text-color);
    text-decoration: none;
    border-radius: var(--banner-button-border-radius);
    transition: background-color 0.3s ease;
    font-family: var(--banner-button-font-family);
    font-weight: var(--banner-button-font-weight);
  }

  .banner-button:hover {
    background-color: var(--banner-button-hover-color);
  }

  .autoplay-slideshow .swiper-pagination {
    position: absolute;
    bottom: -30px;
    left: 0;
    width: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 8px;
    z-index: 10;
  }

  .swiper-pagination .swiper-pagination-bullet {
    width: var(--bullet-width);
    height: var(--bullet-height);
    border-radius: var(--bullet-radius);
    background-color: rgba(var(--bullet-background-color), var(--bullet-background-opacity));
    /* opacity: 0.5; */
    margin: 0;
    transition: all 0.3s ease;
  }

  .swiper-pagination .swiper-pagination-bullet-active {
    width: var(--bullet-active-width);
    background-color: rgba(var(--active-bullet-color), 1);
    opacity: 2 !important;
  }

  .autoplay-slideshow .swiper-horizontal > .swiper-pagination-bullets,
  .autoplay-slideshow .swiper-pagination-bullets.swiper-pagination-horizontal {
    bottom: 30px;
    width: 100%;
    left: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 8px;
  }

  .autoplay-slideshow .swiper-pagination-progressbar {
    background: rgba(0, 0, 0, 0.1);
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 4px;
    z-index: 10;
  }

  .swiper-pagination-progressbar .swiper-pagination-progressbar-fill {
    background: rgba(var(--active-bullet-color), 1);
  }

  @media screen and (max-width: 640px) {
    .swiper-pagination .swiper-pagination {
      margin-top: var(--pagination-margin-top-mobile);
      min-height: var(--pagination-min-height-mobile);
    }

    .swiper-pagination .swiper-pagination-bullet {
      width: var(--bullet-width-mobile);
      height: var(--bullet-height-mobile);
    }

    .swiper-pagination .swiper-pagination-bullet-active {
      width: var(--bullet-active-width-mobile);
    }

    .banner-text {
      left: 5%;
      max-width: 90%;
    }

    .banner-title {
      font-size: calc(var(--banner-title-font-size) * 0.8);
    }

    .banner-description {
      font-size: calc(var(--banner-description-font-size) * 0.9);
    }
  }
{% endstylesheet %}

<style>
  #autoplay-slideshow--{{ unique_id }} {
    --banner-title-color: {{ section.settings.banner_title_color }};
    --banner-title-font-family: {{ section.settings.banner_title_font.family }}, {{ section.settings.banner_title_font.fallback_families }};
    --banner-title-font-size: {{ section.settings.banner_title_font_size }}rem;
    --banner-title-font-weight: {{ section.settings.banner_title_font.weight }};
    --banner-description-font-family: {{ section.settings.banner_description_font.family }}, {{ section.settings.banner_description_font.fallback_families }};
    --banner-description-font-size: {{ section.settings.banner_description_font_size }}rem;
    --banner-description-font-weight: {{ section.settings.banner_description_font.weight }};
    --banner-button-color: {{ section.settings.banner_button_color }};
    --banner-button-hover-color: {{ section.settings.banner_button_hover_color }};
    --banner-button-text-color: {{ section.settings.banner_button_text_color }};
    --banner-button-font-family: {{ section.settings.banner_button_font.family }}, {{ section.settings.banner_button_font.fallback_families }};
    --banner-button-font-weight: {{ section.settings.banner_button_font.weight }};
    --banner-button-border-radius: {{ section.settings.banner_button_border_radius }}px;
    --swiper-aspect-desktop: {{ swiper_aspect_desktop | default: "1920 / 640" }};
    --swiper-aspect-mobile: {{ swiper_aspect_mobile | default: "750 / 1100" }};
    --pagination-margin-top: {{ pagination_margin_top }}px;
    --pagination-margin-top-mobile: {{ pagination_margin_top_mobile }}px;
    --pagination-min-height: {{ pagination_min_height }}px;
    --pagination-min-height-mobile: {{ pagination_min_height_mobile }}px;
    --bullet-width: {{ bullet_width }}px;
    --bullet-height: {{ bullet_height }}px;
    --bullet-radius: {{ bullet_radius }}px;
    --bullet-width-mobile: {{ bullet_width_mobile }}px;
    --bullet-height-mobile: {{ bullet_height_mobile }}px;
    --bullet-active-width: {{ bullet_active_width }}px;
    --bullet-active-width-mobile: {{ bullet_active_width_mobile }}px;
    --bullet-color: {{ bullet_color }};
    --active-bullet-color: {{ active_bullet_color.red }},  {{ active_bullet_color.green}}, {{ active_bullet_color.blue }};
    --bullet-background-color: {{ bullet_color.red}} , {{ bullet_color.green }} , {{ bullet_color.blue }};
    --bullet-background-opacity: {{ section.settings.bullet_background_opacity }};
  }
</style>

<!-- Add wrapper div for proper pagination positioning -->
<div class="banner-wrapper" style="position: relative; padding-bottom: 50px;">
  <div id="autoplay-slideshow--{{ unique_id }}" class="swiper autoplay-slideshow autoplay-slideshow--{{ unique_id }}">
    <div class="swiper-wrapper swiper-wrapper--{{ unique_id }}">
      {% for block in section.blocks %}
        <div class="swiper-slide swiper-slide--{{ unique_id }}">
          <div class="banner-content">
            <div class="banner-text">
              <h1 class="banner-title">{{ banner_title | escape }}</h1>
              {% if banner_description != blank %}
                <p class="banner-description">{{ banner_description | escape }}</p>
              {% endif %}
              <a href="{{ button_link }}" class="banner-button">{{ button_text | escape }}</a>
            </div>
            <a href="{{ block.settings.collection_link }}">
              <picture>
                <!-- Desktop image (min-width: 750px) -->
                <source media="(min-width: 750px)" srcset="{{ block.settings.slide_desktop | image_url: width: 1920 }}" width="1920" height="640" >
                <!-- Mobile image (max-width: 749px) -->
                <source media="(max-width: 749px)" srcset="{{ block.settings.slide_mobile | image_url: width: 750 }}" width="750" height="1100" >
                <!-- Fallback image -->
                <img src="{{ block.settings.slide_desktop | image_url: width: 1920 }}" alt="{{ block.settings.slide_desktop.alt | escape }}" width="1920" height="640" loading="eager" >
              </picture>
            </a>
          </div>
        </div>
      {% endfor %}
    </div>
    
    <!-- Pagination below the slides -->
    <div class="swiper-pagination swiper-pagination--{{ unique_id }}"></div>
  </div>
</div>

<!-- Swiper JS -->
<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js" defer="defer"></script>

<!-- Initialize Swiper -->
<script>
  window.addEventListener("DOMContentLoaded", function() {
    // Make sure Swiper is loaded
    if (typeof Swiper === 'undefined') {
      // If Swiper is not loaded yet, wait for it
      var swiperCheckInterval = setInterval(function() {
        if (typeof Swiper !== 'undefined') {
          clearInterval(swiperCheckInterval);
          initSwiper();
        }
      }, 100);
    } else {
      initSwiper();
    }
    
    function initSwiper() {
      var swiper = new Swiper(".autoplay-slideshow--{{ unique_id }}", {
        loop: true,
        centeredSlides: true,
        spaceBetween: 30,
        autoplay: {
          delay: {{ autoplay_speed }},
          disableOnInteraction: false,
        },
        pagination: {
          el: ".swiper-pagination--{{ unique_id }}",
          clickable: true,
          type: 'bullets'
        },
        on: {
          init: function() {
            console.log("Swiper initialized");
          },
          slideChange: function() {
            console.log("Slide changed");
          }
        }
      });
    }
  });
</script>

{% schema %}
{
  "name": "Slideshow Banner",
  "tag": "section",
  "class": "section",
  "disabled_on": {
    "groups": ["header", "footer"]
  },
  "settings": [
    {
      "type": "header",
      "content": "Banner Text"
    },
    {
      "type": "font_picker",
      "id": "banner_title_font",
      "label": "Title Font",
      "default": "helvetica_n4"
    },
    {
      "type": "text",
      "id": "title",
      "label": "Banner Title",
      "default": "Your Slide Title"
    },
    {
      "type": "range",
      "id": "banner_title_font_size",
      "label": "Title Font Size",
      "min": 1,
      "max": 6,
      "step": 0.1,
      "default": 3,
      "unit": "rem"
    },
    {
      "type": "font_picker",
      "id": "banner_description_font",
      "label": "Description Font",
      "default": "helvetica_n4"
      
    },
    {
      "type": "textarea",
      "id": "description",
      "label": "Banner Description",
      "default": "Add a compelling description to engage your audience and drive conversions."
    },
    {
      "type": "range",
      "id": "banner_description_font_size",
      "label": "Description Font Size",
      "min": 0.8,
      "max": 3,
      "step": 0.1,
      "default": 1.2,
      "unit": "rem"
    },
    {
      "type": "color",
      "id": "banner_title_color",
      "label": "Text Color",
      "default": "#ffffff"
    },
    {
      "type": "header",
      "content": "Button Settings"
    },
    {
      "type": "font_picker",
      "id": "banner_button_font",
      "label": "Button Font",
      "default": "helvetica_n7"
    },
    {
      "type": "text",
      "id": "button_text",
      "label": "Button Text",
      "default": "Shop Now"
    },
    {
      "type": "url",
      "id": "button_link",
      "label": "Button Link"
    },
    {
      "type": "range",
      "id": "banner_button_border_radius",
      "label": "Button Border Radius",
      "min": 0,
      "max": 50,
      "step": 1,
      "default": 4,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "bullet_background_opacity",
      "label": "Bullet Background Opacity",
      "min": 0,
      "max": 1,
      "step": 0.1,
      "default": 0.5
    },
    {
      "type": "color",
      "id": "banner_button_color",
      "label": "Button Background Color",
      "default": "#0080FF"
    },
    {
      "type": "color",
      "id": "banner_button_hover_color",
      "label": "Button Hover Background Color",
      "default": "#0056b3"
    },
    {
      "type": "color",
      "id": "banner_button_text_color",
      "label": "Button Text Color",
      "default": "#ffffff"
    },
    {
      "type": "header",
      "content": "Slideshow Layout"
    },
    {
      "type": "text",
      "id": "swiper_aspect_desktop",
      "label": "Aspect Ratio (Desktop)",
      "default": "1920 / 640",
      "info": "Width / Height - e.g. 1920 / 640"
    },
    {
      "type": "text",
      "id": "swiper_aspect_mobile",
      "label": "Aspect Ratio (Mobile)",
      "default": "750 / 1100",
      "info": "Width / Height - e.g. 750 / 1100"
    },
    {
      "type": "range",
      "id": "autoplay_speed",
      "label": "Autoplay Speed",
      "info": "Time between slide transitions in milliseconds",
      "min": 1000,
      "max": 9000,
      "step": 1000,
      "default": 3000,
      "unit": "ms"
    },
    {
      "type": "url",
      "id": "collection_link",
      "label": "Slide Image Link"
    },
    {
      "type": "header",
      "content": "Pagination Bullets"
    },
    {
      "type": "range",
      "id": "pagination_margin_top",
      "label": "Pagination Margin Top (Desktop)",
      "min": 0,
      "max": 100,
      "step": 1,
      "default": 20,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "pagination_margin_top_mobile",
      "label": "Pagination Margin Top (Mobile)",
      "min": 0,
      "max": 100,
      "step": 1,
      "default": 10,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "pagination_min_height",
      "label": "Pagination Min Height (Desktop)",
      "min": 0,
      "max": 100,
      "step": 1,
      "default": 16,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "pagination_min_height_mobile",
      "label": "Pagination Min Height (Mobile)",
      "min": 0,
      "max": 100,
      "step": 1,
      "default": 12,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "bullet_width",
      "label": "Bullet Width (Desktop)",
      "min": 0,
      "max": 1200,
      "step": 50,
      "default": 50,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "bullet_height",
      "label": "Bullet Height (Desktop)",
      "min": 0,
      "max": 100,
      "step": 1,
      "default": 8,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "bullet_radius",
      "label": "Bullet Radius",
      "min": 0,
      "max": 100,
      "step": 1,
      "default": 6,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "bullet_width_mobile",
      "label": "Bullet Width (Mobile)",
      "min": 0,
      "max": 100,
      "step": 1,
      "default": 12,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "bullet_height_mobile",
      "label": "Bullet Height (Mobile)",
      "min": 0,
      "max": 100,
      "step": 1,
      "default": 6,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "bullet_active_width",
      "label": "Active Bullet Width (Desktop)",
      "min": 0,
      "max": 100,
      "step": 1,
      "default": 32,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "bullet_active_width_mobile",
      "label": "Active Bullet Width (Mobile)",
      "min": 0,
      "max": 100,
      "step": 1,
      "default": 24,
      "unit": "px"
    },
    {
      "type": "color",
      "id": "bullet_color",
      "label": "Bullet Color",
      "default": "#999999"
    },
    {
      "type": "color",
      "id": "active_bullet_color",
      "label": "Active Bullet Color",
      "default": "#000000"
    }
  ],
  "blocks": [
    {
      "type": "slide",
      "name": "Slide",
      "settings": [
        {
          "type": "header",
          "content": "Slide Images Settings"
        },
        {
          "type": "image_picker",
          "id": "slide_desktop",
          "label": "Desktop Slide Image"
        },
        {
          "type": "image_picker",
          "id": "slide_mobile",
          "label": "Mobile Slide Image"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Slideshow Banner"
    }
  ]
}
{% endschema %}
