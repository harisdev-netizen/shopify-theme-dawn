{%- liquid
  assign banner_title = section.settings.title
  assign button_link = section.settings.button_link
  assign button_text = section.settings.button_text
  assign swiper_aspect_desktop = section.settings.swiper_aspect_desktop
  assign swiper_aspect_mobile = section.settings.swiper_aspect_mobile
  assign unique_id = section.id
  assign autoplay_speed = section.settings.autoplay_speed
  assign bullet_color = section.settings.bullet_color
  assign active_bullet_color = section.settings.active_bullet_color
  assign pagination_margin_top = section.settings.pagination_margin_top
  assign pagination_margin_top_mobile = section.settings.pagination_margin_top_mobile
  assign pagination_min_height = section.settings.pagination_min_height
  assign pagination_min_height_mobile = section.settings.pagination_min_height_mobile
  assign bullet_width = section.settings.bullet_width
  assign bullet_height = section.settings.bullet_height
  assign bullet_radius = section.settings.bullet_radius
  assign bullet_width_mobile = section.settings.bullet_width_mobile
  assign bullet_height_mobile = section.settings.bullet_height_mobile
  assign bullet_active_width_mobile = section.settings.bullet_active_width_mobile
  assign bullet_active_width = section.settings.bullet_active_width
-%}

{% stylesheet %}
  .autoplay-slideshow {
    width: 100%;
    position: relative;
  }

  .autoplay-slideshow .swiper-wrapper {
    width: 100%;
    height: auto;
    aspect-ratio: var(--swiper-aspect-desktop);
    position: relative;
  }

  @media screen and (max-width: 749px) {
    .autoplay-slideshow .swiper-wrapper {
      aspect-ratio: var(--swiper-aspect-mobile);
    }
  }

  .swiper-slide {
    width: 100%;
    height: 100%;
    top: 0;
    left: 0;
  }

  .swiper-slide img {
    display: block;
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .banner-content {
    position: relative;
    /* display: flex;
    align-items: center;
    justify-content: flex-start; */
    height: 100%;
    /* padding: 2rem; */
    color: var(--banner-title-color, #fff);
  }

  .banner-text {
    position: absolute;
    left: 2rem;
    z-index: 2;
    max-width: 50%;
  }

  .banner-title {
    font-size: var(--banner-title-font-size, 2rem);
    font-family: var(--banner-title-font-family, Arial, sans-serif);
    font-weight: bold;
    margin-bottom: 1rem;
    color: var(--banner-title-color);
  }

  .banner-button {
    display: inline-block;
    padding: 0.75rem 1.5rem;
    background-color: var(--banner-button-color);
    color: var(--banner-button-text-color);
    text-decoration: none;
    border-radius: var(--banner-button-border-radius, 4px);
    transition: background-color 0.3s ease;
  }

  .banner-button:hover {
    background-color: var(--banner-button-hover-color);
  }

  .autoplay-slideshow .swiper-pagination {
    position: relative;
    margin-top: var(--pagination-margin-top);
    min-height: var(--pagination-min-height);
    display: flex;
    justify-content: center;
    align-items: center;
    opacity: 0;
    transition: opacity 0.3s ease-in-out;
  }

  .autoplay-slideshow .swiper-pagination.swiper-pagination-bullets {
    opacity: 1;
  }

  .autoplay-slideshow .swiper-pagination-bullet {
    width: var(--bullet-width);
    height: var(--bullet-height);
    border-radius: var(--bullet-radius);
    background-color: var(--bullet-color);
    transition: all 0.5s ease-in-out;
  }

  .autoplay-slideshow .swiper-pagination-bullet-active {
    width: var(--bullet-active-width);
    background-color: var(--active-bullet-color);
  }

  @media screen and (max-width: 640px) {
    .autoplay-slideshow .swiper-pagination {
      margin-top: var(--pagination-margin-top-mobile);
      min-height: var(--pagination-min-height-mobile);
    }

    .autoplay-slideshow .swiper-pagination-bullet {
      width: var(--bullet-width-mobile);
      height: var(--bullet-height-mobile);
    }

    .autoplay-slideshow .swiper-pagination-bullet-active {
      width: var(--bullet-active-width-mobile);
    }
  }
{% endstylesheet %}

<style>
  #autoplay-slideshow--{{ unique_id }} {
    --banner-title-color: {{ section.settings.banner_title_color }};
    --banner-title-font-family: {{ section.settings.banner_title_font_family }};
    --banner-title-font-size: {{ section.settings.banner_title_font_size }}rem;
    --banner-button-color: {{ section.settings.banner_button_color }};
    --banner-button-hover-color: {{ section.settings.banner_button_hover_color }};
    --banner-button-text-color: {{ section.settings.banner_button_text_color }};
    --banner-button-border-radius: {{ section.settings.banner_button_border_radius | default: 4 }}px;
    --swiper-aspect-desktop: {{ swiper_aspect_desktop | default: "1920 / 640" }};
    --swiper-aspect-mobile: {{ swiper_aspect_mobile | default: "750 / 1100" }};
    --pagination-margin-top: {{ pagination_margin_top | default: "20px" }};
    --pagination-margin-top-mobile: {{ pagination_margin_top_mobile | default: "10px" }};
    --pagination-min-height: {{ pagination_min_height | default: "16px" }};
    --pagination-min-height-mobile: {{ pagination_min_height_mobile | default: "12px" }};
    --bullet-width: {{ bullet_width | default: "16px" }};
    --bullet-height: {{ bullet_height | default: "8px" }};
    --bullet-radius: {{ bullet_radius | default: "6px" }};
    --bullet-width-mobile: {{ bullet_width_mobile | default: "12px" }};
    --bullet-height-mobile: {{ bullet_height_mobile | default: "6px" }};
    --bullet-active-width: {{ bullet_active_width | default: "32px" }};
    --bullet-active-width-mobile: {{ bullet_active_width_mobile | default: "24px" }};
    --bullet-color: {{ bullet_color | default: "#999" }};
    --active-bullet-color: {{ active_bullet_color | default: "#000" }};
  }
</style>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css">

<div id="autoplay-slideshow--{{ unique_id }}"class="swiper autoplay-slideshow autoplay-slideshow--{{ unique_id }}">
  <div class="swiper-wrapper swiper-wrapper--{{ unique_id }}">
    {% for block in section.blocks %}
      <div class="swiper-slide swiper-slide--{{ unique_id }}">
        <div class="banner-content">
          <div class="banner-text">
            <h1 class="banner-title">{{ banner_title | escape }}</h1>
            <a href="{{ button_link }}" class="banner-button">{{ button_text | escape }}</a>
          </div>
          <a href="{{ block.settings.collection_link }}">
            <picture>
              <!-- Desktop image (min-width: 750px) -->
              <source media="(min-width: 750px)" srcset="{{ block.settings.slide_desktop | image_url: width: 1920 }}" width="1920" height="640" >
              <!-- Mobile image (max-width: 749px) -->
              <source media="(max-width: 749px)" srcset="{{ block.settings.slide_mobile | image_url: width: 750 }}" width="750" height="1100" >
              <!-- Fallback image -->
              <img src="{{ block.settings.slide_desktop | image_url: width: 1920 }}" alt="{{ block.settings.slide_desktop.alt | escape }}" width="1920" height="640" loading="eager" >
            </picture>
          </a>
        </div>
      </div>
    {% endfor %}
  </div>

  <div class="swiper-pagination swiper-pagination--{{ unique_id }}"></div>
</div>

<!-- Swiper JS -->
<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js" defer="defer"></script>

<!-- Initialize Swiper -->
<script>
    window.addEventListener("load", function () {
    var swiper = new Swiper(".autoplay-slideshow--{{ unique_id }}", {
      loop: true,
      centeredSlides: true,
      spaceBetween: 30,
      autoplay: {
        delay: {{ autoplay_speed }},
        disableOnInteraction: false,
      },
      pagination: {
        el: ".swiper-pagination--{{ unique_id }}",
        clickable: true,
      },
      on: {
        init: function () {
          document.querySelector(".autoplay-slideshow--{{ unique_id }}")?.classList.add("swiper-initialized");
        }
      }
    });
  });
</script>

{% schema %}
{
  "name": "Slideshow Banner",
  "tag": "section",
  "class": "section",
  "disabled_on": {
    "groups": ["header", "footer"]
  },
  "settings": [
    {
      "type": "paragraph",
      "content": "Create a slideshow banner with autoplay and customizable settings like aspect ratios, autoplay speed, and bullet styles. Add slides with images for desktop and mobile, and optional links."
    },
    {
      "type": "header",
      "content": "Banner Layout"
    },
    {
      "type": "text",
      "id": "swiper_aspect_desktop",
      "label": "Aspect Ratio (Desktop)",
      "default": "1920 / 640"
    },
    {
      "type": "text",
      "id": "swiper_aspect_mobile",
      "label": "Aspect Ratio (Mobile)",
      "default": "750 / 1100"
    },
    {
      "type": "range",
      "id": "autoplay_speed",
      "label": "Rotate slides in Mobile",
      "info": "1000ms = 1sec",
      "min": 1000,
      "max": 9000,
      "step": 1000,
      "default": 2000,
      "unit": "ms"
    },
    {
      "type": "range",
      "id": "pagination_margin_top",
      "label": "Pagination Margin Top (Desktop)",
      "min": 0,
      "max": 100,
      "step": 1,
      "default": 20,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "pagination_margin_top_mobile",
      "label": "Pagination Margin Top (Mobile)",
      "min": 0,
      "max": 100,
      "step": 1,
      "default": 10,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "pagination_min_height",
      "label": "Pagination Min Height (Desktop)",
      "min": 0,
      "max": 100,
      "step": 1,
      "default": 16,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "pagination_min_height_mobile",
      "label": "Pagination Min Height (Mobile)",
      "min": 0,
      "max": 100,
      "step": 1,
      "default": 12,
      "unit": "px"
    },
    {
      "type": "header",
      "content": "Banner Bullet Design"
    },
    {
      "type": "range",
      "id": "bullet_width",
      "label": "Bullet Width (Desktop)",
      "min": 0,
      "max": 100,
      "step": 1,
      "default": 16,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "bullet_height",
      "label": "Bullet Height (Desktop)",
      "min": 0,
      "max": 100,
      "step": 1,
      "default": 8,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "bullet_radius",
      "label": "Bullet Radius",
      "min": 0,
      "max": 100,
      "step": 1,
      "default": 6,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "bullet_width_mobile",
      "label": "Bullet Width (Mobile)",
      "min": 0,
      "max": 100,
      "step": 1,
      "default": 12,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "bullet_height_mobile",
      "label": "Bullet Height (Mobile)",
      "min": 0,
      "max": 100,
      "step": 1,
      "default": 6,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "bullet_active_width_mobile",
      "label": "Active Bullet Width (Mobile)",
      "min": 0,
      "max": 100,
      "step": 1,
      "default": 24,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "bullet_active_width",
      "label": "Active Bullet Width (Desktop)",
      "min": 0,
      "max": 100,
      "step": 1,
      "default": 32,
      "unit": "px"
    },

    {
        "type": "header",
        "content": "Banner Text and Button"
        },
        {
          "type": "text",
          "id": "banner_title_font_family",
          "label": "Title Font Family",
          "default": "Arial, sans-serif"
        },
        {
          "type": "text",
          "id": "title",
          "label": "Banner Title",
          "default": "Your Slide Title"
        },
        {
          "type": "text",
          "id": "button_text",
          "label": "Button Text",
          "default": "Shop Now"
        },
        {
          "type": "url",
          "id": "button_link",
          "label": "Button Link"
        },
        {
          "type": "url",
          "id": "collection_link",
          "label": "Slide Image Link"
        },
        {
          "type": "range",
          "id": "banner_title_font_size",
          "label": "Title Font Size (rem)",
          "min": 0.5,
          "max": 10,
          "step": 0.1,
          "default": 2
        },
        
        {
          "type": "range",
          "id": "banner_button_border_radius",
          "label": "Button Border Radius",
          "min": 0,
          "max": 50,
          "step": 1,
          "default": 4,
          "unit": "px"
        },
    {
      "type": "color",
      "id": "bullet_color",
      "label": "Bullet Color",
      "default": "#999999"
    },
    {
      "type": "color",
      "id": "active_bullet_color",
      "label": "Active Bullet Color",
      "default": "#000000"
    },
    {
          "type": "color",
          "id": "banner_title_color",
          "label": "Title Color",
          "default": "#ffffff"
        },
        {
          "type": "color",
          "id": "banner_button_color",
          "label": "Button Background Color",
          "default": "#0080FF"
        },
        {
          "type": "color",
          "id": "banner_button_hover_color",
          "label": "Button Hover Background Color",
          "default": "#0056b3"
        },
        {
          "type": "color",
          "id": "banner_button_text_color",
          "label": "Button Text Color",
          "default": "#ffffff"
        }
  ],
  "blocks": [
    {
      "type": "slide",
      "name": "Slide",
      "settings": [
        {
          "type": "image_picker",
          "id": "slide_desktop",
          "label": "Desktop Slide Image"
        },
        {
          "type": "image_picker",
          "id": "slide_mobile",
          "label": "Mobile Slide Image"
        },
      ]
    }
  ],
  "presets": [
    {
      "name": "Slideshow Banner",
    }
  ]
}
{% endschema %}
